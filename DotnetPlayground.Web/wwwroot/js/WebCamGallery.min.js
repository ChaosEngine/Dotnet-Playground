"use strict";function WebCamGalleryOnLoad(e){let t=new Date;const a=$("#btnReplAllImg");async function o(e){return new Promise(((t,a)=>{switch(e){case"webp":{const e=new Image;e.onload=function(){const a=e.width>0&&e.height>0;t(a)},e.onerror=function(){t(!1)},e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"}break;case"avif":{const e=new Image;e.onload=function(){t(2===e.height)},e.onerror=function(){t(!1)},e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="}break;default:a(new Error("bad imgType"))}}))}function n(){$("img.active:not([src])").each((function(e,t){const a=t,o=a.alt;if(o&&"no img"!==o){let e,t;a.src=g_AppRootPath+"WebCamImages/"+o;const n=a.parentNode.getElementsByTagName("source");n.length<=0?(e=document.createElement("source"),a.parentNode.insertBefore(e,a),t=document.createElement("source"),a.parentNode.insertBefore(t,a)):(e=n[0],t=n[1]),e.type="image/avif",e.srcset=g_AppRootPath+"WebCamImages/"+o.replace(".jpg",".avif"),t.type="image/webp",t.srcset=g_AppRootPath+"WebCamImages/"+o.replace(".jpg",".webp")}}))}function i(){const e=document.getElementById("my-player"),t=e.dataset.poster;e.setAttribute("poster",t),delete e.dataset.poster,videojs("my-player")}function A(){Array.prototype.slice.call(document.querySelectorAll("#youtube-tab iframe:not([src])")).forEach((function(e){e.style.display="block",e.src=e.dataset.src}))}function r(e){const t=e.currentTarget||e;if(t.classList.contains("active"))return;const a=t.parentNode.parentNode.href.replace(/\.[^.]*$/,"");let o,n;t.src=a+".jpg",t.alt="thumbnail-"+a.split(/thumbnail-(\d+)/)[1];const i=t.parentNode.getElementsByTagName("source");i.length<=0?(o=document.createElement("source"),t.parentNode.insertBefore(o,t),n=document.createElement("source"),t.parentNode.insertBefore(n,t)):(o=i[0],n=i[1]),""!==o.srcset&&"images/no_img.svg"!==o.srcset||(o.type="image/avif",o.srcset=a+".avif"),""!==n.srcset&&"images/no_img.svg"!==n.srcset||(n.type="image/webp",n.srcset=a+".webp"),t.classList.remove("inactive"),t.classList.add("active")}function s(){$("img.inactive").each((function(e,t){r(t)}))}$("#aLive").on("click",(async function(){const a=document.querySelector("#live");if(null!==a){if("refreshing"!==a.getAttribute("data-last-modified")){const o=.001*(new Date-t);let n=String(o)+" secs elapsed since last live-image load";o>e&&(n+=", reloading!",await async function(e){e.setAttribute("data-last-modified","refreshing");try{const a=await fetch(g_AppRootPath+"WebCamImages/?handler=live",{method:"GET",headers:{"Cache-Control":"no-cache"}});if(!0!==a.ok)throw new Error("response not ok");const o=a.headers.get("Last-Modified"),n=await a.blob(),i=URL.createObjectURL(n);e.onload=function(){URL.revokeObjectURL(this.src)},e.src=i,e.setAttribute("data-last-modified",o),t=new Date}catch(a){e.setAttribute("data-last-modified",(new Date).toUTCString()),t=new Date,alert(a.toString())}}(a)),console.log(n)}else console.log("still reloading!")}})),$("#links a").on("click",(async function(e){function t(e,t,a){const o=e.target||e.srcElement,n=o.parentNode.parentNode.parentNode,i=o.src?o.parentNode.parentNode:o,A={event:e,onopen:function(){s()}},r=Array.prototype.slice.call(n.getElementsByTagName("a")).map((function(e){let o,n;return t?(o=e.href.replace(".jpg",".avif"),n="image/avif"):a?(o=e.href.replace(".jpg",".webp"),n="image/webp"):(o=e.href,n="image/jpeg"),{title:e.title,href:o.replace("thumbnail","out"),type:n,thumbnail:o}})),c=t?i.href.replace(".jpg",".avif"):a?i.href.replace(".jpg",".webp"):i.href;A.index=-1,r.some((function(e,t){if(e.thumbnail===c)return A.index=t,!0})),blueimp.Gallery(r,A)}(e=e||window.event).preventDefault();const a=await o("avif");if(!1===a){t(e,a,await o("webp"))}else{t(e,a,!1)}})),a.on("click",s),$("img.inactive").each((function(e,t){if(e<7)r(t);else{const e="images/no_img.svg";t.onmouseover||(t.onmouseover=r);const a=g_AppRootPath+e;t.src=a;let o=document.createElement("source");o.type="image/svg+xml",o.srcset=e,t.parentNode.insertBefore(o,t),o=document.createElement("source"),o.type="image/svg+xml",o.srcset=e,t.parentNode.insertBefore(o,t)}}));const c=g_AppRootPath+"WebCamImages/?handler=live";if(window.onpopstate=function(e){const t=(e.state?e.state.foo:location.hash)||"#live-tab",o=$(`#myTab a[href='${t}']`);void 0!==o&&o.tab("show"),"#gallery-tab"===t?(a.show(),n()):"#live-tab"===t?($("#live").attr("src",c),a.hide()):"#youtube-tab"===t?(A(),a.hide()):"#video-tab"===t?(i(),a.hide()):a.hide()},void 0!==location.hash&&location.hash.length>0){const e=location.hash,t=$(`#myTab a[href='${e}']`);void 0!==t&&t.tab("show"),"#gallery-tab"===e?(a.show(),n()):"#video-tab"===e?(i(),a.hide()):"#youtube-tab"===e?(A(),a.hide()):a.hide()}else a.hide();$("#myTab a.active").length<=0&&$("#myTab a").first().tab("show"),$("#myTab a[href='#gallery-tab']").hasClass("active")?(a.show(),n()):$("#myTab a[href='#video-tab']").hasClass("active")?i():$("#myTab a[href='#youtube-tab']").hasClass("active")?A():$("#myTab a[href='#live-tab']").hasClass("active")&&$("#live").attr("src",c),$("#myTab a").on("click",(function(e){if(void 0!==e.target.hash){-1!==e.target.hash.indexOf("gallery-tab")?(a.show(),n()):-1!==e.target.hash.indexOf("live-tab")?($("#live").attr("src",c),a.hide()):-1!==e.target.hash.indexOf("video-tab")?(i(),a.hide()):-1!==e.target.hash.indexOf("youtube-tab")?(A(),a.hide()):a.hide();const t=e.target.hash;let o={foo:t};window.history.pushState(o,t,t)}})),!0===$("#secretAction").is(":visible")&&($("#btnAnnualMovieGenerator").prop("disabled",!1),$("#divAnnualMovieGenerator").on("show.bs.collapse",(function(e){!function(e){const t={RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()},a=JSON.stringify({Result:"query",Product:["qqq","xxxx","yyyy","zzzzzz"]});$("#tbAnnualMovieGenerator").html('<thead><tr><th scope="col">#</th><th scope="col">Name</th><th scope="col">Hash</th><th scope="col">Date</th></tr></thead><caption>Loading...</caption><tbody></tbody>'),$.ajax({method:"POST",url:"AnnualTimelapse/?handler=SecretAction",contentType:"application/json",dataType:"json",data:a,headers:t}).done((function(e){console.log(e),"Error0"!==e.result?($("#tbAnnualMovieGenerator caption").remove(),$(e.product).each((function(e,t){$("#tbAnnualMovieGenerator tbody").append("<tr><td>"+t[0]+"</td><td>"+t[1]+"</td><td>"+t[2]+"</td><td>"+t[3]+"</td></tr>")}))):alert("error")})).fail((function(e,t,a){alert("error: "+t+" "+a),$("#tbAnnualMovieGenerator").html("")})).always((function(){e.target.disabled=""}))}(e)})))}
//# sourceMappingURL=WebCamGallery.min.js.map
