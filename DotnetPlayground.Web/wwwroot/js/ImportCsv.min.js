window.addEventListener("load",()=>{let e=null;const t=t=>{const n=new FileReader;n.onload=function(t){const n=t.target.result;let o=document.getElementById("delimiter").value;if(""===o||0===o.length){o=[[";",(n.match(/;/g)||[]).length],[",",(n.match(/,/g)||[]).length],["\t",(n.match(/\t/g)||[]).length],["|",(n.match(/\|/g)||[]).length],[":",(n.match(/:/g)||[]).length]].sort(([,e],[,t])=>t-e)[0][0],document.getElementById("delimiter").value=o}const{table:r,rawData:i}=((e,t)=>{const n=e.replace(/"(.*?)"/gs,e=>e.replace(/[\r\n]/g,"")).split(/\r?\n/);if(n.length<=0)return null;const o=document.createElement("table");o.className="table table-bordered caption-top";let r=null,i=0;const a=[];for(const e of n){if(0===e.length||e.startsWith("#"))continue;const n=e.split(new RegExp(`${t}(?=(?:[^"]*"[^"]*")*[^"]*$)`)).map(e=>e.replace(/^"|"$/g,"").trim());if(r){const e=r.insertRow();a[i]=[];for(let t=0;t<n.length;t++){const o=e.insertCell(),r=n[t].trim();o.textContent=r,a[i][t]=r}}else{r=o.createTHead();const e=r.insertRow();a[i]=[];for(let t=0;t<n.length;t++){const o=document.createElement("th"),r=n[t].trim();o.textContent=r,e.appendChild(o),a[i][t]=r}r=o.createTBody()}i++}return r=o.createCaption(),r.dataset.i18n="importCsv.totalRows",r.dataset.i18nOptions=`{ 'count': ${i} }`,r.textContent=`Total rows: ${i}`,{table:o,rawData:a}})(n,o);e=i,r&&(document.getElementById("tableContainer").innerHTML="",document.getElementById("tableContainer").appendChild(r),document.getElementById("tableContainer").classList.remove("d-none"),window.localize&&window.localize("#tableContainer"))},n.readAsText(t)},n=e=>{e.currentTarget.classList.remove("drop-zone-highlight")};document.getElementById("csvFile").addEventListener("change",e=>{const n=e.target.files[0];n&&t(n)}),["dragover","dragenter"].forEach(e=>{document.getElementById("dropZone").addEventListener(e,e=>{e.preventDefault(),e.currentTarget.classList.add("drop-zone-highlight")})}),document.getElementById("dropZone").addEventListener("dragleave",e=>{n(e)}),document.getElementById("dropZone").addEventListener("drop",e=>{if(e.preventDefault(),n(e),e.dataTransfer.files.length>0){const t=document.getElementById("csvFile");t.files=e.dataTransfer.files,t.dispatchEvent(new Event("change"))}}),document.getElementById("csvForm").addEventListener("submit",async t=>{t.preventDefault();const n=t.target;if(!n.checkValidity())return void n.reportValidity();if(!e||0===e.length)return void myAlert(i18next.t("importCsv.noCsv"),i18next.t("importCsv.Failed"));const o=t.submitter;try{switch(o.name?o.name:null){case"btnSubmit":{o.disabled=!0;const t=document.getElementById("compression").checked;await async function(e,t=!1){try{const n=JSON.stringify(e),o={"Content-Type":"application/json",RequestVerificationToken:document.querySelector('input[name="__RequestVerificationToken"]').value};let r,i;if(t){const e=new CompressionStream("gzip"),t=new Blob([n]).stream().pipeThrough(e),a=await new Response(t).arrayBuffer();r=a,i=a.byteLength,o["Content-Encoding"]="gzip"}else r=n,i=n.length;console.log("Payload size:",i);const a=await fetch("ImportCsv",{method:"POST",body:r,credentials:"same-origin",cache:"no-cache",redirect:"follow",referrerPolicy:"no-referrer",headers:o});if(!a.ok){const e=await a.text();return"string"==typeof e&&-1!==e.indexOf("Error")?void myAlert(i18next.t("importCsv.undErr"),i18next.t("importCsv.Failed")):void myAlert(i18next.t("importCsv.badResp"),i18next.t("importCsv.Failed"))}const l=await a.json();myAlert(i18next.t("importCsv.goodResult",{rowsCount:l.rowsCount,nonEmptyCellsCount:l.nonEmptyCellsCount}),i18next.t("importCsv.success"))}catch(e){myAlert(i18next.t("importCsv.exInterc"),i18next.t("importCsv.Failed")),console.error("Error:",e)}}(e,t)}break;case"btnCount":o.disabled=!0,await async function(e){const t=e.reduce((e,t)=>e+t.reduce((e,t)=>e+(t&&""!==t?1:0),0),0);myAlert(i18next.t("importCsv.goodResult",{rowsCount:e.length,nonEmptyCellsCount:t}),i18next.t("importCsv.success"))}(e);break;default:myAlert(i18next.t("importCsv.unknBtn"),i18next.t("importCsv.Failed"))}}finally{o.disabled=!1}})});
//# sourceMappingURL=ImportCsv.min.js.map
