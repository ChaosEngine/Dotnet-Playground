window.addEventListener("load",(()=>{let t=null;document.getElementById("csvFile").addEventListener("change",(e=>{const n=e.target.files[0];if(n){const e=new FileReader;e.onload=function(e){const n=e.target.result,o=document.getElementById("delimiter").value,{table:i,rawData:r}=((t,e)=>{const n=t.replace(/"(.*?)"/gs,(t=>t.replace(/[\r\n]/g,""))).split(/\r?\n/);if(n.length<=0)return null;const o=document.createElement("table");o.className="table table-bordered caption-top";let i=null,r=0;const s=[];for(const t of n){if(0===t.length||t.startsWith("#"))continue;const n=t.split(new RegExp(`${e}(?=(?:[^"]*"[^"]*")*[^"]*$)`)).map((t=>t.replace(/^"|"$/g,"").trim()));if(i){const t=i.insertRow();s[r]=[];for(let e=0;e<n.length;e++){const o=t.insertCell(),i=n[e].trim();o.textContent=i,s[r][e]=i}}else{i=o.createTHead();const t=i.insertRow();s[r]=[];for(let e=0;e<n.length;e++){const o=document.createElement("th"),i=n[e].trim();o.textContent=i,t.appendChild(o),s[r][e]=i}i=o.createTBody()}r++}return i=o.createCaption(),i.dataset.i18n="importCsv.totalRows",i.dataset.i18nOptions=`{ 'count': ${r} }`,i.textContent=`Total rows: ${r}`,{table:o,rawData:s}})(n,o||",");t=r,i&&(document.getElementById("tableContainer").innerHTML="",document.getElementById("tableContainer").appendChild(i),window.localize&&window.localize("#tableContainer"))},e.readAsText(n)}})),document.getElementById("csvForm").addEventListener("submit",(async e=>{e.preventDefault();const n=e.target;if(!n.checkValidity())return void n.reportValidity();if(!t||0===t.length)return void myAlert(i18next.t("importCsv.noCsv"),i18next.t("importCsv.Failed"));const o=e.submitter;try{switch(o.name?o.name:null){case"btnSubmit":{o.disabled=!0;const e=document.getElementById("compression").checked;await async function(t,e=!1){try{const n=JSON.stringify(t),o={"Content-Type":"application/json",RequestVerificationToken:document.querySelector('input[name="__RequestVerificationToken"]').value};let i,r;if(e){const t=new CompressionStream("gzip"),e=new Blob([n]).stream().pipeThrough(t),s=await new Response(e).arrayBuffer();i=s,r=s.byteLength,o["Content-Encoding"]="gzip"}else i=n,r=n.length;console.log("Payload size:",r);const s=await fetch("ImportCsv",{method:"POST",body:i,credentials:"same-origin",cache:"no-cache",redirect:"follow",referrerPolicy:"no-referrer",headers:o});if(!s.ok){const t=await s.text();return"string"==typeof t&&-1!==t.indexOf("Error")?void myAlert(i18next.t("importCsv.undErr"),i18next.t("importCsv.Failed")):void myAlert(i18next.t("importCsv.badResp"),i18next.t("importCsv.Failed"))}const a=await s.json();myAlert(i18next.t("importCsv.goodResult",{rowsCount:a.rowsCount,nonEmptyCellsCount:a.nonEmptyCellsCount}),i18next.t("importCsv.success"))}catch(t){myAlert(i18next.t("importCsv.exInterc"),i18next.t("importCsv.Failed")),console.error("Error:",t)}}(t,e)}break;case"btnCount":o.disabled=!0,await async function(t){const e=t.reduce(((t,e)=>t+e.reduce(((t,e)=>t+(e&&""!==e?1:0)),0)),0);myAlert(i18next.t("importCsv.goodResult",{rowsCount:t.length,nonEmptyCellsCount:e}),i18next.t("importCsv.success"))}(t);break;default:myAlert(i18next.t("importCsv.unknBtn"),i18next.t("importCsv.Failed"))}}finally{o.disabled=!1}}))}));
//# sourceMappingURL=ImportCsv.min.js.map
