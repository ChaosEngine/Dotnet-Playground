window.addEventListener("load",(()=>{let t=null;document.getElementById("csvFile").addEventListener("change",(e=>{const n=e.target.files[0];if(n){const e=new FileReader;e.onload=function(e){const n=e.target.result,o=document.getElementById("delimiter").value,{table:r,rawData:i}=((t,e)=>{const n=t.replace(/"(.*?)"/gs,(t=>t.replace(/[\r\n]/g,""))).split(/\r?\n/);if(n.length<=0)return null;const o=document.createElement("table");o.className="table table-bordered";let r=null,i=0;const a=[];for(const t of n){if(0===t.length||t.startsWith("#"))continue;const n=t.split(new RegExp(`${e}(?=(?:[^"]*"[^"]*")*[^"]*$)`)).map((t=>t.replace(/^"|"$/g,"").trim()));if(!r){r=o.createTHead();const t=r.insertRow();a[i]=[];for(let e=0;e<n.length;e++){const o=document.createElement("th"),r=n[e].trim();o.textContent=r,t.appendChild(o),a[i][e]=r}r=o.createTBody(),i++;continue}const s=r.insertRow();a[i]=[];for(let t=0;t<n.length;t++){const e=s.insertCell(),o=n[t].trim();e.textContent=o,a[i][t]=o}i++}return r=o.createCaption(),r.dataset.i18n="importCsv.totalRows",r.dataset.i18nOptions=`{ 'count': ${i} }`,r.textContent=`Total rows: ${i}`,{table:o,rawData:a}})(n,o||",");t=i,r&&(document.getElementById("tableContainer").innerHTML="",document.getElementById("tableContainer").appendChild(r),window.localize&&window.localize("#tableContainer"))},e.readAsText(n)}})),document.getElementById("csvForm").addEventListener("submit",(async e=>{e.preventDefault();const n=e.target;if(!n.checkValidity())return void n.reportValidity();if(!t||0===t.length)return void myAlert(i18next.t("importCsv.noCsv"),i18next.t("importCsv.Failed"));switch(e.submitter?e.submitter.name:null){case"btnSubmit":await async function(t){const e=JSON.stringify(t),n=document.querySelector('input[name="__RequestVerificationToken"]').value;try{const t=await fetch("ImportCsv",{method:"POST",body:e,credentials:"same-origin",cache:"no-cache",redirect:"follow",referrerPolicy:"no-referrer",headers:{"Content-Type":"application/json",RequestVerificationToken:n}});if(!t.ok){const e=await t.text();return"string"==typeof e&&-1!==e.indexOf("Error")?void myAlert(i18next.t("importCsv.undErr"),i18next.t("importCsv.Failed")):void myAlert(i18next.t("importCsv.badResp"),i18next.t("importCsv.Failed"))}const o=await t.json();myAlert(i18next.t("importCsv.goodResult",{rowsCount:o.rowsCount,nonEmptyCellsCount:o.nonEmptyCellsCount}),i18next.t("importCsv.success"))}catch(t){myAlert(i18next.t("importCsv.exInterc"),i18next.t("importCsv.Failed")),console.error("Error:",t)}}(t);break;case"btnCount":await async function(t){const e=t.reduce(((t,e)=>t+e.reduce(((t,e)=>t+(e&&""!==e?1:0)),0)),0);myAlert(i18next.t("importCsv.goodResult",{rowsCount:t.length,nonEmptyCellsCount:e}),i18next.t("importCsv.success"))}(t);break;default:myAlert(i18next.t("importCsv.unknBtn"),i18next.t("importCsv.Failed"))}}))}));
//# sourceMappingURL=ImportCsv.min.js.map
